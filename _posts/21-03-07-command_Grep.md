---
layout: post
title: PPxでGrep
version: PPx183以降 KeyModuleR8以降
date: 2024-02-06
comment: 改稿。
repository: tar80/ppm-grep
categories: PPc @plugin
---

### 説明

各種grepの出力結果を仮想エントリとして扱えるようにする設定集です。

- 使用するコマンド、出力先を選択できます。  
  コマンドは grep, ripgrep, jvgrep, git grep、出力先はPPc, PPv, エディタから選択できます。
- PPvで表示時には一時的にキャレットモードに変更します。
- 検索結果にはlfActions\.js経由で指定したコマンドを実行可能。
- 検索結果は%*temp()内に蓄積されるので、[同階層の隣合うディレクトリに移動]({{ site.baseurl}}{% post_url 20-12-25-move_directory %})を使うと簡単に履歴をたどれます。  

### 使い方

1. ppm-grepをインストールして設定する。
1. `CTRL+W`で一行編集を呼び、検索するキーワードを入力する。  
   - このとき、マークがあればマーク対象を、なければカーソル位置かディレクトリ全体を  
   対象とします。(プラグインの設定から変更できます)
   - optionボタンからはgrepコマンドの引数を変更できます。  
   固定されたオプションはエントリ表示のために必要となるオプションです。
   - 編集中に`CTRL+W`で、使用するgrepコマンドを変更できます。
   - `CTRL+@`で対象とするコミットを選択できます。(git grep用)
   - エディタへの出力はvimのquickfixに出力するために用意してあります。  
   他のエディタでも同等の機能があれば利用できるかもしれません。  
   結果は拡張子の語尾に`_e`を付加した`<keyword>.ppmgrep_e`に出力されます。
1. エントリリスト上では、マスクやインクリメンタルサーチを使って候補のさらなる絞り込みができます。  
   - `R`キーで前後行のマスクをトグルできます。
   - `Y`キーでPPvをトグルできます。PPv起動中は`ENTER`キーで行ジャンプできます。  
   - `S`キーではsedを使って文字列の置換も可能です。行選択が可能なのでより柔軟に置換対象を選別できます。  
   必要かどうかは別として…

<BR>
**エントリリスト上への出力**
![sample]({{ site.baseurl }}{% link /public/img/grep.webp %})

> PPvはhtml tagの解析など独自に文書の内容を整形する機能があるため、画像のように行番号にずれが生じることがあります。
> この場合はPPvのオプションに`-tag:off`などを加えれば行番号が一致します。

<BR>
**sedを使った置換**
![sample]({{ site.baseurl }}{% link /public/img/grep_sed.webp %})
